--- Plex.sh	2025-08-09 02:56:11.000000000 +0200
+++ Plex.sh	2025-11-07 10:39:05.459774681 +0100
@@ -1,6 +1,15 @@
 #!/bin/sh
 BASE_DIR=$(dirname "$(readlink -f "$0")")
-export LD_LIBRARY_PATH=$BASE_DIR/lib/:$BASE_DIR:$LD_LIBRARY_PATH
+# export LD_LIBRARY_PATH=$BASE_DIR/lib/:$BASE_DIR:$LD_LIBRARY_PATH
+
+export APPIMAGE_ORIGINAL_LC_ALL=$LC_ALL
+export APPIMAGE_ORIGINAL_QML_IMPORT_PATH=$QML_IMPORT_PATH
+export APPIMAGE_ORIGINAL_QML2_IMPORT_PATH=$QML2_IMPORT_PATH
+export APPIMAGE_ORIGINAL_QT_PLUGIN_PATH=$QT_PLUGIN_PATH
+export APPIMAGE_ORIGINAL_QTDIR=$QTDIR
+export APPIMAGE_ORIGINAL_QT_QPA_PLATFORM_PLUGIN_PATH=$QT_QPA_PLATFORM_PLUGIN_PATH
+export APPIMAGE_ORIGINAL_FONTCONFIG_PATH=$FONTCONFIG_PATH
+
 export LC_ALL=C.UTF-8
 export QML_IMPORT_PATH=$BASE_DIR/qml/:$QML_IMPORT_PATH
 export QML2_IMPORT_PATH=$BASE_DIR/qml/:$QML2_IMPORT_PATH
@@ -10,6 +19,14 @@
 export QT_QPA_PLATFORM_PLUGIN_PATH=$BASE_DIR/plugins/platforms:$QT_QPA_PLATFORM_PLUGIN_PATH
 export FONTCONFIG_PATH=${FONTCONFIG_PATH:-/etc/fonts}
 
+export APPIMAGE_STARTUP_LC_ALL=$LC_ALL
+export APPIMAGE_STARTUP_QML_IMPORT_PATH=$QML_IMPORT_PATH
+export APPIMAGE_STARTUP_QML2_IMPORT_PATH=$QML2_IMPORT_PATH
+export APPIMAGE_STARTUP_QT_PLUGIN_PATH=$QT_PLUGIN_PATH
+export APPIMAGE_STARTUP_QTDIR=$QTDIR
+export APPIMAGE_STARTUP_QT_QPA_PLATFORM_PLUGIN_PATH=$QT_QPA_PLATFORM_PLUGIN_PATH
+export APPIMAGE_STARTUP_FONTCONFIG_PATH=$FONTCONFIG_PATH
+
 # Disable wayland unless the user has set the value before
 export DISABLE_WAYLAND=${DISABLE_WAYLAND:-1}
 
@@ -37,9 +54,7 @@
 export PLEX_MEDIA_SERVER_RESOURCES=$BASE_DIR/resources
 
 # For MPV to get hardware decoding
-if [ -n "$SNAP" ]; then
-  export LIBVA_DRIVERS_PATH=${SNAP}/lib/dri
-fi
+export LIBVA_DRIVERS_PATH=${SNAP:-${BASE_DIR}}/lib/dri
 
 # SESSION_MANAGER often causes issues with Qt so we unset it. Setting PLEX_KEEP_SESSION_MANAGER
 # will override this behavior.
@@ -47,4 +62,5 @@
   unset SESSION_MANAGER
 fi
 
-"$BASE_DIR"/bin/Plex "$@"
+export APPDIR="$BASE_DIR"
+LD_PRELOAD="$BASE_DIR"/lib/exec.so "$BASE_DIR"/bin/Plex "$@"
